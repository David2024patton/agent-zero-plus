<html>

<head>
    <title>List Plugins</title>
    <script type="module">
        import { store } from "/components/settings/plugins/plugins-list-store.js";
    </script>
</head>

<body>
    <div x-data>
        <template x-if="$store.pluginsListStore">
            <div x-init="$store.pluginsListStore.init()" x-destroy="$store.pluginsListStore.onClose()">

                <div class="section-title">List Plugins</div>
                <div class="section-description">
                    Plugins extend Agent Zero with messaging channels, tools, and integrations.
                    Each plugin has its own configuration. Drop new plugin folders into <code>plugins/</code> to add
                    them.
                </div>

                <div class="plugins-toolbar">
                    <button type="button" class="button confirm" title="Refresh"
                        @click="$store.pluginsListStore.loadPlugins()" :disabled="$store.pluginsListStore.loading">
                        <span class="icon material-symbols-outlined">refresh</span> Refresh
                    </button>
                </div>

                <!-- Loading -->
                <div x-show="$store.pluginsListStore.loading" class="plugins-loading">
                    <span>Loading plugins...</span>
                </div>

                <!-- Error -->
                <div x-show="$store.pluginsListStore.error" class="plugins-error">
                    <span x-text="$store.pluginsListStore.error"></span>
                </div>

                <!-- Empty -->
                <template
                    x-if="!$store.pluginsListStore.loading && !$store.pluginsListStore.error && $store.pluginsListStore.plugins.length === 0">
                    <div class="plugins-empty">No plugins found. Add plugin folders to <code>plugins/</code> to get
                        started.
                    </div>
                </template>

                <!-- Plugin List -->
                <div class="plugins-list" x-show="!$store.pluginsListStore.configuring">
                    <template x-for="plugin in $store.pluginsListStore.plugins" :key="plugin.id">
                        <div class="plugin-card" :class="{'plugin-card-enabled': plugin.enabled}">
                            <div class="plugin-header">
                                <div class="plugin-heading">
                                    <div class="plugin-title-row">
                                        <span class="plugin-title" x-text="plugin.name || plugin.id"></span>
                                        <span class="plugin-badge" x-text="plugin.type"></span>
                                        <span class="plugin-version"
                                            x-text="plugin.version ? 'v' + plugin.version : ''"></span>
                                    </div>
                                    <div class="plugin-description" x-text="plugin.description || 'No description.'">
                                    </div>
                                    <code class="plugin-path" x-text="plugin.path"></code>
                                </div>
                                <div class="plugin-actions">
                                    <label class="toggle" title="Enable / Disable">
                                        <input type="checkbox" :checked="plugin.enabled"
                                            @change="$store.pluginsListStore.togglePlugin(plugin)" />
                                        <span class="toggler"></span>
                                    </label>
                                    <button type="button" class="button" title="Configure"
                                        @click="$store.pluginsListStore.openConfig(plugin)"
                                        :disabled="plugin.config.length === 0">
                                        <span class="icon material-symbols-outlined">settings</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Config Panel (shown when configuring a plugin) -->
                <template x-if="$store.pluginsListStore.configuring">
                    <div class="plugin-config-panel">
                        <div class="config-panel-header">
                            <span class="config-panel-title">
                                Configure: <span x-text="$store.pluginsListStore.configuring.name"></span>
                            </span>
                            <button type="button" class="button cancel" @click="$store.pluginsListStore.cancelConfig()">
                                <span class="icon material-symbols-outlined">close</span> Cancel
                            </button>
                        </div>

                        <div class="config-fields">
                            <template x-for="field in $store.pluginsListStore.configuring.config" :key="field.key">
                                <div class="field">
                                    <div class="field-label">
                                        <div class="field-title" x-text="field.label"></div>
                                        <div class="field-description" x-text="field.description"></div>
                                    </div>
                                    <div class="field-control">
                                        <!-- Switch type -->
                                        <template x-if="field.type === 'switch'">
                                            <label class="toggle">
                                                <input type="checkbox" x-model="field.value" />
                                                <span class="toggler"></span>
                                            </label>
                                        </template>
                                        <!-- Password type -->
                                        <template x-if="field.type === 'password'">
                                            <input type="password" class="text-input" x-model="field.value"
                                                :placeholder="field.label" />
                                        </template>
                                        <!-- Text (default) -->
                                        <template x-if="field.type !== 'switch' && field.type !== 'password'">
                                            <input type="text" class="text-input" x-model="field.value"
                                                :placeholder="field.label" />
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <div class="config-panel-footer">
                            <button type="button" class="button confirm" @click="$store.pluginsListStore.saveConfig()">
                                <span class="icon material-symbols-outlined">save</span> Save Configuration
                            </button>
                        </div>
                    </div>
                </template>

            </div>
        </template>
    </div>

    <style>
        .plugins-toolbar {
            display: flex;
            justify-content: flex-end;
            margin-top: 0.5rem;
        }

        .plugins-loading {
            width: 100%;
            text-align: center;
            margin-top: 1rem;
            margin-bottom: 1rem;
            color: var(--color-secondary);
        }

        .plugins-error {
            color: var(--color-error);
            margin: 0.5rem 0;
            padding: 0.5rem;
            background: var(--color-error-bg);
            border-radius: 4px;
        }

        .plugins-empty {
            margin-top: 1rem;
            padding: 0.75rem;
            border: 1px dashed var(--color-border);
            border-radius: 4px;
            text-align: center;
            color: var(--color-text-secondary);
        }

        .plugins-list {
            margin-top: 1rem;
        }

        .plugin-card {
            border: 1px solid var(--color-border);
            border-radius: 6px;
            padding: 0.75rem;
            margin-top: 0.75rem;
            background: var(--color-bg-primary);
            transition: border-color 0.2s;
        }

        .plugin-card-enabled {
            border-color: var(--color-accent, #3b82f6);
        }

        .plugin-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 1rem;
        }

        .plugin-heading {
            display: flex;
            flex-direction: column;
            min-width: 0;
            flex: 1 1 auto;
        }

        .plugin-title-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .plugin-title {
            font-weight: 600;
            font-size: 1rem;
        }

        .plugin-badge {
            font-size: 0.7rem;
            padding: 0.15rem 0.4rem;
            border-radius: 3px;
            background: var(--color-accent, #3b82f6);
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .plugin-version {
            font-size: 0.8rem;
            color: var(--color-text-muted);
        }

        .plugin-description {
            margin-top: 0.35rem;
            color: var(--color-text-secondary);
            font-size: var(--font-size-small);
        }

        .plugin-path {
            margin-top: 0.35rem;
            font-size: 0.8rem;
            color: var(--color-text-muted);
            word-break: break-all;
        }

        .plugin-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex: 0 0 auto;
        }

        /* Config panel */
        .plugin-config-panel {
            margin-top: 1rem;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            padding: 1rem;
            background: var(--color-bg-primary);
        }

        .config-panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--color-border);
        }

        .config-panel-title {
            font-weight: 600;
            font-size: 1.05rem;
        }

        .config-fields .field {
            margin-bottom: 0.75rem;
        }

        .config-panel-footer {
            margin-top: 1rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--color-border);
            display: flex;
            justify-content: flex-end;
        }
    </style>
</body>

</html>